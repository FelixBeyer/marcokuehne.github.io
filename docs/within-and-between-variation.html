<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Within and Between Variation | L04 Paneldata</title>
  <meta name="description" content="This is my first gitbook." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Within and Between Variation | L04 Paneldata" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/scream.jpg" />
  <meta property="og:description" content="This is my first gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Within and Between Variation | L04 Paneldata" />
  
  <meta name="twitter:description" content="This is my first gitbook." />
  <meta name="twitter:image" content="/scream.jpg" />

<meta name="author" content="Marco Kühne" />


<meta name="date" content="2022-08-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-visualization.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Empirical Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Dust and Dark</a></li>
<li class="part"><span><b>I Preface</b></span></li>
<li class="chapter" data-level="1" data-path="teach-learn-repeat.html"><a href="teach-learn-repeat.html"><i class="fa fa-check"></i><b>1</b> Teach – Learn – Repeat</a></li>
<li class="chapter" data-level="2" data-path="a-question-you-care-about.html"><a href="a-question-you-care-about.html"><i class="fa fa-check"></i><b>2</b> A Question You Care About</a></li>
<li class="chapter" data-level="3" data-path="data-is-everywhere.html"><a href="data-is-everywhere.html"><i class="fa fa-check"></i><b>3</b> Data is everywhere</a></li>
<li class="part"><span><b>II Data Analysis</b></span></li>
<li class="chapter" data-level="4" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>4</b> Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="regression.html"><a href="regression.html#from-zero-to-hero"><i class="fa fa-check"></i><b>4.1</b> From Zero To Hero</a></li>
<li class="chapter" data-level="4.2" data-path="regression.html"><a href="regression.html#from-artists-and-economists"><i class="fa fa-check"></i><b>4.2</b> From Artists and Economists</a></li>
<li class="chapter" data-level="4.3" data-path="regression.html"><a href="regression.html#data-is-everywhere-1"><i class="fa fa-check"></i><b>4.3</b> Data is everywhere</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="regression.html"><a href="regression.html#data-in-a-table"><i class="fa fa-check"></i><b>4.3.1</b> Data in a table</a></li>
<li class="chapter" data-level="4.3.2" data-path="regression.html"><a href="regression.html#data-in-a-graph"><i class="fa fa-check"></i><b>4.3.2</b> Data in a graph</a></li>
<li class="chapter" data-level="4.3.3" data-path="regression.html"><a href="regression.html#the-trend"><i class="fa fa-check"></i><b>4.3.3</b> The trend</a></li>
<li class="chapter" data-level="4.3.4" data-path="regression.html"><a href="regression.html#the-blackbox"><i class="fa fa-check"></i><b>4.3.4</b> The blackbox</a></li>
<li class="chapter" data-level="4.3.5" data-path="regression.html"><a href="regression.html#nobodys-perfect"><i class="fa fa-check"></i><b>4.3.5</b> Nobody’s perfect</a></li>
<li class="chapter" data-level="4.3.6" data-path="regression.html"><a href="regression.html#vocab-wrap-up"><i class="fa fa-check"></i><b>4.3.6</b> Vocab Wrap-Up</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="regression.html"><a href="regression.html#for-the-truly-dedicated"><i class="fa fa-check"></i><b>4.4</b> For the truly dedicated</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="regression.html"><a href="regression.html#algebra"><i class="fa fa-check"></i><b>4.4.1</b> Algebra</a></li>
<li class="chapter" data-level="4.4.2" data-path="regression.html"><a href="regression.html#analysis"><i class="fa fa-check"></i><b>4.4.2</b> Analysis</a></li>
<li class="chapter" data-level="4.4.3" data-path="regression.html"><a href="regression.html#take-the-long-way-home"><i class="fa fa-check"></i><b>4.4.3</b> Take the Long Way Home</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="regression.html"><a href="regression.html#survival-of-the-fittest-line"><i class="fa fa-check"></i><b>4.5</b> Survival of the Fittest Line</a></li>
<li class="chapter" data-level="4.6" data-path="regression.html"><a href="regression.html#on-the-shoulders-of-giants"><i class="fa fa-check"></i><b>4.6</b> On the Shoulders of Giants</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="5" data-path="git-and-github.html"><a href="git-and-github.html"><i class="fa fa-check"></i><b>5</b> Git and Github</a>
<ul>
<li class="chapter" data-level="5.1" data-path="git-and-github.html"><a href="git-and-github.html#install-github-and-git"><i class="fa fa-check"></i><b>5.1</b> Install Github and Git</a></li>
<li class="chapter" data-level="5.2" data-path="git-and-github.html"><a href="git-and-github.html#working-with-git"><i class="fa fa-check"></i><b>5.2</b> Working with Git</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="git-and-github.html"><a href="git-and-github.html#git-version"><i class="fa fa-check"></i><b>5.2.1</b> git version</a></li>
<li class="chapter" data-level="5.2.2" data-path="git-and-github.html"><a href="git-and-github.html#git-config"><i class="fa fa-check"></i><b>5.2.2</b> git config</a></li>
<li class="chapter" data-level="5.2.3" data-path="git-and-github.html"><a href="git-and-github.html#git-init"><i class="fa fa-check"></i><b>5.2.3</b> git init</a></li>
<li class="chapter" data-level="5.2.4" data-path="git-and-github.html"><a href="git-and-github.html#git-status-and-diff"><i class="fa fa-check"></i><b>5.2.4</b> git status and diff</a></li>
<li class="chapter" data-level="5.2.5" data-path="git-and-github.html"><a href="git-and-github.html#git-commit"><i class="fa fa-check"></i><b>5.2.5</b> git commit</a></li>
<li class="chapter" data-level="5.2.6" data-path="git-and-github.html"><a href="git-and-github.html#git-add"><i class="fa fa-check"></i><b>5.2.6</b> git add</a></li>
<li class="chapter" data-level="5.2.7" data-path="git-and-github.html"><a href="git-and-github.html#git-remote-add"><i class="fa fa-check"></i><b>5.2.7</b> git remote add</a></li>
<li class="chapter" data-level="5.2.8" data-path="git-and-github.html"><a href="git-and-github.html#git-push"><i class="fa fa-check"></i><b>5.2.8</b> git push</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="git-and-github.html"><a href="git-and-github.html#basic-routines"><i class="fa fa-check"></i><b>5.3</b> Basic Routines</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="git-and-github.html"><a href="git-and-github.html#add-commit-push"><i class="fa fa-check"></i><b>5.3.1</b> Add + Commit + Push</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="git-and-github.html"><a href="git-and-github.html#resources"><i class="fa fa-check"></i><b>5.4</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="slope-fields.html"><a href="slope-fields.html"><i class="fa fa-check"></i><b>6</b> Slope Fields</a>
<ul>
<li class="chapter" data-level="6.1" data-path="slope-fields.html"><a href="slope-fields.html#definition"><i class="fa fa-check"></i><b>6.1</b> Definition</a></li>
<li class="chapter" data-level="6.2" data-path="slope-fields.html"><a href="slope-fields.html#slope-fields-in-r"><i class="fa fa-check"></i><b>6.2</b> Slope Fields in R</a></li>
<li class="chapter" data-level="6.3" data-path="slope-fields.html"><a href="slope-fields.html#understandable-examples"><i class="fa fa-check"></i><b>6.3</b> Understandable Examples</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="slope-fields.html"><a href="slope-fields.html#y-y"><i class="fa fa-check"></i><b>6.3.1</b> y’ = y</a></li>
<li class="chapter" data-level="6.3.2" data-path="slope-fields.html"><a href="slope-fields.html#y--y"><i class="fa fa-check"></i><b>6.3.2</b> y’ = -y</a></li>
<li class="chapter" data-level="6.3.3" data-path="slope-fields.html"><a href="slope-fields.html#y-x2"><i class="fa fa-check"></i><b>6.3.3</b> y’ = x^2</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="slope-fields.html"><a href="slope-fields.html#initial-value-problem"><i class="fa fa-check"></i><b>6.4</b> Initial value problem</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="group-comparison.html"><a href="group-comparison.html"><i class="fa fa-check"></i><b>7</b> Group Comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="group-comparison.html"><a href="group-comparison.html#learning-goals"><i class="fa fa-check"></i><b>7.1</b> Learning Goals</a></li>
<li class="chapter" data-level="7.2" data-path="group-comparison.html"><a href="group-comparison.html#story-telling"><i class="fa fa-check"></i><b>7.2</b> Story Telling</a></li>
<li class="chapter" data-level="7.3" data-path="group-comparison.html"><a href="group-comparison.html#comparability"><i class="fa fa-check"></i><b>7.3</b> Comparability</a></li>
<li class="chapter" data-level="7.4" data-path="group-comparison.html"><a href="group-comparison.html#soep-practice-data"><i class="fa fa-check"></i><b>7.4</b> SOEP Practice Data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="group-comparison.html"><a href="group-comparison.html#loading-the-data"><i class="fa fa-check"></i><b>7.4.1</b> Loading the Data</a></li>
<li class="chapter" data-level="7.4.2" data-path="group-comparison.html"><a href="group-comparison.html#inspect-the-data"><i class="fa fa-check"></i><b>7.4.2</b> Inspect the Data</a></li>
<li class="chapter" data-level="7.4.3" data-path="group-comparison.html"><a href="group-comparison.html#stata-information"><i class="fa fa-check"></i><b>7.4.3</b> Stata information</a></li>
<li class="chapter" data-level="7.4.4" data-path="group-comparison.html"><a href="group-comparison.html#summary-statistics"><i class="fa fa-check"></i><b>7.4.4</b> Summary statistics</a></li>
<li class="chapter" data-level="7.4.5" data-path="group-comparison.html"><a href="group-comparison.html#missing-data"><i class="fa fa-check"></i><b>7.4.5</b> Missing data</a></li>
<li class="chapter" data-level="7.4.6" data-path="group-comparison.html"><a href="group-comparison.html#standardization"><i class="fa fa-check"></i><b>7.4.6</b> Standardization</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="group-comparison.html"><a href="group-comparison.html#never-use-pie-charts"><i class="fa fa-check"></i><b>7.5</b> Never use pie charts</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mean-comparison.html"><a href="mean-comparison.html"><i class="fa fa-check"></i><b>8</b> Mean Comparison</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mean-comparison.html"><a href="mean-comparison.html#learning-goals-1"><i class="fa fa-check"></i><b>8.1</b> Learning Goals</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mean-comparison.html"><a href="mean-comparison.html#data-preparation"><i class="fa fa-check"></i><b>8.1.1</b> Data Preparation</a></li>
<li class="chapter" data-level="8.1.2" data-path="mean-comparison.html"><a href="mean-comparison.html#grouped-mean"><i class="fa fa-check"></i><b>8.1.2</b> Grouped Mean</a></li>
<li class="chapter" data-level="8.1.3" data-path="mean-comparison.html"><a href="mean-comparison.html#furious-with-factors"><i class="fa fa-check"></i><b>8.1.3</b> Furious with Factors</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mean-comparison.html"><a href="mean-comparison.html#students-t-test"><i class="fa fa-check"></i><b>8.2</b> Student’s t-test</a></li>
<li class="chapter" data-level="8.3" data-path="mean-comparison.html"><a href="mean-comparison.html#plot-with-confidence"><i class="fa fa-check"></i><b>8.3</b> Plot with Confidence</a></li>
<li class="chapter" data-level="8.4" data-path="mean-comparison.html"><a href="mean-comparison.html#independent-t-test"><i class="fa fa-check"></i><b>8.4</b> Independent t-test</a></li>
<li class="chapter" data-level="8.5" data-path="mean-comparison.html"><a href="mean-comparison.html#dependent-t-test"><i class="fa fa-check"></i><b>8.5</b> Dependent t-test</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="learning-goals-2.html"><a href="learning-goals-2.html"><i class="fa fa-check"></i><b>9</b> Learning Goals</a></li>
<li class="chapter" data-level="10" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>10</b> Paneldata</a></li>
<li class="chapter" data-level="11" data-path="data-preparation-1.html"><a href="data-preparation-1.html"><i class="fa fa-check"></i><b>11</b> Data Preparation</a></li>
<li class="chapter" data-level="12" data-path="group-by-person.html"><a href="group-by-person.html"><i class="fa fa-check"></i><b>12</b> Group by person</a></li>
<li class="chapter" data-level="13" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>13</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="13.1" data-path="data-visualization.html"><a href="data-visualization.html#average-health-per-year"><i class="fa fa-check"></i><b>13.1</b> Average Health per Year</a></li>
<li class="chapter" data-level="13.2" data-path="data-visualization.html"><a href="data-visualization.html#individual-health-per-year"><i class="fa fa-check"></i><b>13.2</b> Individual Health per Year</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="data-visualization.html"><a href="data-visualization.html#random-panel-sample"><i class="fa fa-check"></i><b>13.2.1</b> Random Panel Sample</a></li>
<li class="chapter" data-level="13.2.2" data-path="data-visualization.html"><a href="data-visualization.html#personalize-functions"><i class="fa fa-check"></i><b>13.2.2</b> Personalize Functions</a></li>
<li class="chapter" data-level="13.2.3" data-path="data-visualization.html"><a href="data-visualization.html#minimum-observations-per-group"><i class="fa fa-check"></i><b>13.2.3</b> Minimum Observations per Group</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="within-and-between-variation.html"><a href="within-and-between-variation.html"><i class="fa fa-check"></i><b>14</b> Within and Between Variation</a>
<ul>
<li class="chapter" data-level="14.1" data-path="within-and-between-variation.html"><a href="within-and-between-variation.html#xtsum-from-stata"><i class="fa fa-check"></i><b>14.1</b> XTSUM (from Stata)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://marco-kuehne.com/" target="blank">Visit my personal page</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">L04 Paneldata</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="within-and-between-variation" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">Chapter 14</span> Within and Between Variation<a href="within-and-between-variation.html#within-and-between-variation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Now focus on **within and between variation**. -->
<!-- https://cran.r-project.org/web/packages/gghighlight/vignettes/gghighlight.html -->
<p>Here is a similar plot of life satisfaction for selected people.</p>
<p><img src="Empirical-Research_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>Person 293973 reports a dramatic change in satisfaction from one year to another. Starting from perfect happiness in 2000 (= 10), it drops to complete misery (= 0) and recovers immediately in 2002 (= 10).</p>
<details>
<summary>
<em>Is person 293973 an outlier? Can you think of reasonable scenarios behind the data? </em>
</summary>
<em>Job’s news</em>: take away all that a person holds dear, including children, health, and property. Because this is practice data and we cannot dig deeper into life events potentially triggering these changes.
</details>
<p><br></p>
<p>Look at the previous graph from this perspective:</p>
<ul>
<li><strong>Within variation</strong>: <em>Within</em> means per individual, group or unit over time.</li>
<li><strong>Between variation</strong>: <em>Between</em> means comparing individuals, groups or units (both at a point in time or over time).</li>
</ul>
<p>In 2000 person 293973 and person 317284 both reported a happiness value of 10. In 2000, there is no <strong>difference between</strong> those two people. In 2001 though, 293973 experienced a critical shock and dropped to 0 while 317284 stayed at the very same value of 10. In 2001, the difference between both is 10.</p>
<p>Compare the years 2000 and 2001 for person 293973. The value changes within that person by -10, whereas there is no change for person 317284. You often read about <strong>changes</strong> within people (across time) and about <strong>differences</strong> between them. In the line plot, <strong>within changes</strong> happens along the horizontal x-axis, whereas <strong>between differences</strong> can be measured as the vertical distance on the y-axis.</p>
<p><strong>Between and within variation</strong> are new properties of a panel data variable.</p>
<!-- The question What is the within variation of happiness.  -->
<!-- **Sufficient within variation** is required to apply panel data estimations (later in the course). -->
<div class="infobox2 information">
<p>To fully exploit panel data, we need <strong>enough within variation</strong>.</p>
</div>
<details>
<summary>
<em>Is there enough within variation?</em>
</summary>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-71"></span>
<img src="images/Within_Variation.png" alt="\label{fig:within}Figure 2: Screenshot from a [lecture script of Brüderl and Ludwig.](https://www.ls3.soziologie.uni-muenchen.de/studium-lehre/archiv/teaching-marterials/panel-analysis_april-2019.pdf) The software is Stata." width="80%" />
<p class="caption">
Figure 14.1: Figure 2: Screenshot from a <a href="https://www.ls3.soziologie.uni-muenchen.de/studium-lehre/archiv/teaching-marterials/panel-analysis_april-2019.pdf">lecture script of Brüderl and Ludwig.</a> The software is Stata.
</p>
</div>
</details>
<!-- ### Minimal working example (6 pt) -->
<!-- http://rizaudinsahlan.blogspot.com/2016/06/within-and-between-variation-in-panel.html -->
<!-- The following table shows between and within variation for a minimal panel data example. Three people are observed in three periods each (no missings). The panel data is **balanced** (all individuals are observed in all years, there are no gaps).  -->
<!-- ```{r warning=FALSE, message=FALSE, echo=FALSE, eval=FALSE} -->
<!-- paneldata <- data.frame(id = rep(1:3, each=3), -->
<!--                         time = rep(1:3, times=3), -->
<!--                         x = c(9,10,11,20,20,20,25,30,35)) -->
<!-- paneldata -->
<!-- ``` -->
<!-- Please calculate all columns according to table 1 for the two individuals (id 293973 and 317284). All necessary formulas are provided in the table. Please create all these values by computation. Hint: You may need tidyverse verbs `filter`, `select`, `group_by`, `ungroup` and `mutate`. In a list of commands you can turn the group mode on and off. First you `group_by` your data, do the calculation, `ungroup` and do more calculations. Furthermore, I suggest the `gt` package in order to clean up the table design. Your result should look like this: -->
<!-- ```{r warning=FALSE, message=FALSE, echo=FALSE, eval=TRUE} -->
<!-- library(gt) -->
<!-- library(sjlabelled) -->
<!-- minipanel <- highlights %>% -->
<!--   filter(id %in% c(293973,317284)) %>% -->
<!--   remove_all_labels() -->
<!-- wb <- highlights %>% -->
<!--   filter(id %in% c(293973,317284)) %>% -->
<!--   select(id, year, satisf_org) %>% -->
<!--   group_by(id) %>% -->
<!--   mutate(Individual_Mean = round(mean(satisf_org),2)) %>% -->
<!--   ungroup() %>% -->
<!--   mutate(Overall_Mean = round(mean(satisf_org),2)) %>% -->
<!--   mutate(Between = Individual_Mean - Overall_Mean) %>% -->
<!--   group_by(id) %>% -->
<!--   mutate(Within = satisf_org - Individual_Mean) %>% -->
<!--   ungroup() %>% -->
<!--   mutate(Within_alt = satisf_org - Individual_Mean + Overall_Mean) -->
<!--   wb %>% -->
<!--   gt() %>%  -->
<!--   tab_header( -->
<!--     title = "Understanding between and within variation.") %>%  -->
<!--   tab_options( -->
<!--     heading.title.font.size = "small", -->
<!--     heading.subtitle.font.size = "small", -->
<!--     table.font.size = "small", -->
<!--     data_row.padding = px(2)) -->
<!-- ``` -->
<!-- <br> -->
<!-- ```{r,  results='asis', echo=F} -->
<!-- cat( -->
<!--   '<pre class="r"> -->
<!--   <code class = "hlsj"> <span class="hljs-string"> <br> <br> </span> </code> -->
<!--   </pre> -->
<!--   ') -->
<!-- ``` -->
<!-- ::: {.infobox2 .information data-latex="warning"} -->
<!-- A **minimal working example (MWE)** is useful to understand formulas or data manipulation and is often required in data science or programming discussion boards (such as stackoverflow or statalist.org) -->
<!-- ::: -->
<!-- - <https://stackoverflow.com/help/minimal-reproducible-example> -->
<!-- - <https://www.statalist.org/forums/help#stata> -->
<div id="xtsum-from-stata" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> XTSUM (from Stata)<a href="within-and-between-variation.html#xtsum-from-stata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Stata there is a command <strong>xtsum</strong> which <strong>calculates overall, between and within variation</strong>. This is not implemented in any R package so far. Still, clever people created another personal function on Stack Overflow <a href="https://stackoverflow.com/questions/49282083/xtsum-command-for-r" class="uri">https://stackoverflow.com/questions/49282083/xtsum-command-for-r</a>:</p>
<details>
<summary>
<em>Show me the crazy xtsum code.</em>
</summary>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="within-and-between-variation.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, copy the code and run it, and you can use it in your R session. </span></span>
<span id="cb86-2"><a href="within-and-between-variation.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb86-3"><a href="within-and-between-variation.html#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="within-and-between-variation.html#cb86-4" aria-hidden="true" tabindex="-1"></a>XTSUM <span class="ot">&lt;-</span> <span class="cf">function</span>(data, varname, unit) {</span>
<span id="cb86-5"><a href="within-and-between-variation.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  varname <span class="ot">&lt;-</span> <span class="fu">enquo</span>(varname)</span>
<span id="cb86-6"><a href="within-and-between-variation.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  loc.unit <span class="ot">&lt;-</span> <span class="fu">enquo</span>(unit)</span>
<span id="cb86-7"><a href="within-and-between-variation.html#cb86-7" aria-hidden="true" tabindex="-1"></a>ores <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">ovr.mean=</span><span class="fu">mean</span>(<span class="sc">!!</span> varname, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">ovr.sd=</span><span class="fu">sd</span>(<span class="sc">!!</span> varname, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">ovr.min =</span> <span class="fu">min</span>(<span class="sc">!!</span> varname, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">ovr.max=</span><span class="fu">max</span>(<span class="sc">!!</span> varname, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">ovr.N=</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>((<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span> varname)))))</span>
<span id="cb86-8"><a href="within-and-between-variation.html#cb86-8" aria-hidden="true" tabindex="-1"></a>bmeans <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="sc">!!</span> loc.unit) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">meanx=</span><span class="fu">mean</span>(<span class="sc">!!</span> varname, <span class="at">na.rm=</span>T), <span class="at">t.count=</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span> varname))))</span>
<span id="cb86-9"><a href="within-and-between-variation.html#cb86-9" aria-hidden="true" tabindex="-1"></a>bres <span class="ot">&lt;-</span> bmeans <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">between.sd =</span> <span class="fu">sd</span>(meanx, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">between.min =</span> <span class="fu">min</span>(meanx, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">between.max=</span><span class="fu">max</span>(meanx, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">Units=</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">is.na</span>(t.count))), <span class="at">t.bar=</span><span class="fu">mean</span>(t.count, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb86-10"><a href="within-and-between-variation.html#cb86-10" aria-hidden="true" tabindex="-1"></a>wdat <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="sc">!!</span> loc.unit) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">W.x =</span> <span class="fu">scale</span>(<span class="sc">!!</span> varname, <span class="at">scale=</span><span class="cn">FALSE</span>))</span>
<span id="cb86-11"><a href="within-and-between-variation.html#cb86-11" aria-hidden="true" tabindex="-1"></a>wres <span class="ot">&lt;-</span> wdat <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">within.sd=</span><span class="fu">sd</span>(W.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">within.min=</span><span class="fu">min</span>(W.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">within.max=</span><span class="fu">max</span>(W.x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb86-12"><a href="within-and-between-variation.html#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ores=</span>ores,<span class="at">bres=</span>bres,<span class="at">wres=</span>wres))</span>
<span id="cb86-13"><a href="within-and-between-variation.html#cb86-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>We can use this functionality to compare our prior results.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="within-and-between-variation.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span>
<span id="cb87-2"><a href="within-and-between-variation.html#cb87-2" aria-hidden="true" tabindex="-1"></a>minipanel <span class="ot">&lt;-</span> soep <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="within-and-between-variation.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">293973</span>,<span class="dv">317284</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="within-and-between-variation.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_all_labels</span>()</span>
<span id="cb87-5"><a href="within-and-between-variation.html#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="within-and-between-variation.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">XTSUM</span>(minipanel, <span class="at">varname=</span>satisf_org, <span class="at">unit=</span>id)</span></code></pre></div>
<pre><code>## $ores
##   ovr.mean  ovr.sd ovr.min ovr.max ovr.N
## 1    8.625 3.50255       0      10     8
## 
## $bres
## # A tibble: 1 × 5
##   between.sd between.min between.max Units t.bar
##        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1       2.22        6.67         9.8     2     4
## 
## $wres
## # A tibble: 1 × 3
##   within.sd within.min within.max
##       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1      3.10      -6.67       3.33</code></pre>
<!-- Understanding xtsum output -->
<!-- http://stephenporter.org/files/xtsum_handout.pdf -->
<p><code>XTSUM</code> tells us some more results. The overall mean is 8.62 as expected. The overall smallest value of satisfaction is 0, the highest is 10. We saw this in the graph. We have <em>N=8</em> observations or rows. But we only have <em>n=2</em> units (see the medium panel). Units (people) are observed on average for <code>t.bar = 4</code> periods (one person 3 years, one person 5 years, makes 4 years on average).</p>
<p>Standard deviation <code>sd</code> is at the core of <strong>within and between variation</strong> (since it is a measure of dispersion or variation). In the previous graph, we focused on <strong>within changes</strong> and <strong>between differences</strong>.</p>
<!-- We don't compare or interpret the quantity of variation at this point.  -->
<!-- # ```{r echo = TRUE, eval=TRUE} -->
<!-- # sd(c(6.67,9.80)) -->
<!-- # ``` -->
<div class="infobox2 information">
<p>Think about examples (i.e. variables) that you expect to not have within variation.</p>
</div>
<!-- Wait. Why should there be no within variation for a variable? There are plenty reasons! Think about gender. In the SOEP data gender is never changing (interesting questions about gender identity or transgender cannot be analyzed with SOEP).  -->
<p>Run <code>XTSUM()</code> on different variables to test your knowledge.</p>
<!-- What do you expect to see from `XTSUM()` applied on `sex`?  -->
<!-- <details> -->
<!-- <summary> -->
<!-- **This time: Think first, do later.** -->
<!-- </summary> -->
<!-- Correct. **There is no within variation in gender.** -->
<!-- ```{r warning=FALSE, message=FALSE, echo=FALSE, eval=TRUE} -->
<!-- XTSUM(soep, varname=sex, unit=id) -->
<!-- ``` -->
<!-- </details> -->
<!-- <br> -->
<!-- ### Throwback: t-Test (2 pt) -->
<!-- Remember the two kinds of t-Tests: -->
<!-- - unpaired two sample t-Test -->
<!-- - paired two sample t-Test (= repeated t-Test or *panel t-Test*) -->
<!-- Now you are able to assess what kind of t-Test to apply to what situation (or data). Think about these two tests in terms of between and within variation.  -->
<!-- You get a cross-section by filtering for a given year. Thus, you can be sure that every individual (id) is only included once. But perhaps someone was not asked or was not part of the survey in this particular year, but in several other **years** (so called **waves**).-->
<!-- ```{r echo = TRUE, eval=TRUE} -->
<!-- before_after <- soep %>% -->
<!--   filter(complete.cases(.)) %>% -->
<!--   filter(year == 2000 | year == 2004) %>% # only use year 2000 or 2004 -->
<!--   group_by(id) %>% # look at id groups -->
<!--   filter(n() == 2)  # only keep groups with exactly two observations/rows -->
<!-- ``` -->
<!-- For `before_after` data, please select variables for which the paired and unpaired t-test is working (and makes sense), and for which the unpaired is working while the paired is not.  -->
<!-- ```{r,  results='asis', echo=F} -->
<!-- cat( -->
<!--   '<pre class="r"> -->
<!--   <code class = "hlsj"> <span class="hljs-string"> <br> <br> </span> </code> -->
<!--   </pre> -->
<!--   ') -->
<!-- ``` -->
<!-- ```{r echo = FALSE, eval=FALSE} -->
<!-- # t tests working -->
<!-- t.test(education ~ year, data=before_after, paired=FALSE) -->
<!-- t.test(education ~ year, data=before_after, paired=TRUE) -->
<!-- ``` -->
<!-- ```{r echo = FALSE, eval=FALSE} -->
<!-- # t tests not working -->
<!-- t.test(sex ~ year, data=before_after, paired=FALSE) -->
<!-- t.test(sex ~ year, data=before_after, paired=TRUE) -->
<!-- #t.test(sex ~ id, data=before_after, paired=FALSE) -->
<!-- #t.test(sex ~ id, data=before_after, paired=TRUE) -->
<!-- t.test(satisf_org ~ no_kids>0, data=before_after, paired=TRUE) -->
<!-- # one sample t-test -->
<!-- t.test(before_after$satisf_org)  -->
<!-- # working two sample  -->
<!-- t.test(education ~ sex, data = before_after, paired=FALSE) -->
<!-- t.test(before_after$year,before_after$satisf_org, paired = TRUE) -->
<!-- t.test(health_org ~ year, data=before_after, paired=TRUE) -->
<!-- t.test(health_org ~ year, data=before_after, paired=FALSE) -->
<!-- # not working because of not equal length  -->
<!-- t.test(education ~ sex, data=before_after, paired=TRUE) -->
<!-- t.test(satisf_org ~ sex, data=before_after, paired=TRUE) -->
<!-- # Dariia / Serena: can be calculated technically, but there is no result -->
<!-- t.test(sex ~ year, data=before_after, paired=TRUE) -->
<!-- t.test(health_org ~ sex, data=before_after, paired=FALSE) -->
<!-- t.test(satisf_org ~ sex, data=before_after, paired=FALSE) -->
<!-- t.test(no_kids ~ year, data=before_after, paired=TRUE) -->
<!-- t.test(no_kids ~ year, data=before_after, paired=FALSE) -->
<!-- t.test(sex ~ year, data=before_after, paired=FALSE) -->
<!-- t.test(sex ~ year, data=before_after, paired=TRUE) -->
<!-- t.test(no_kids ~ sex, data=before_after, paired=TRUE) -->
<!-- ``` -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-visualization.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Empirical Research.pdf", "Empirical Research.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 2,
"toolbar": {
"positon": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
